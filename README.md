

### Как работает клиент

Клиент работает в несколько этапов. 

1. Сначала фетчит список ворклогов, появившийся за указанный период. Период задается 
параметрами запроса в unix-time с учетом миллисекунд (поэтому умножаем на 1000). Это 
просто список юез информации. Он нужен, чтобы отдельными запросами взять инфу по 
ворклогам.

2. Подробная инфа грузится отдельными запросами. В каждом запросе передается максимум 
1000 ворклогов. Поэтому, если всего за указанный период больше 1000 вокрлогов, создается
несколько запросов. 

3. Нужна еще информация о задачах  (issues). В инфо о ворклогах доступны только индексы
задач (типа ПРОЕКТ-001). Поэтому берем все индексы из ворклогов, оставляем уникальные и
запрашиваем инфу по задачам. 

4. Итого, метод клиента `get_jira_data` выдает кортеж (worklogs, issues) с массивом объектов
двух видов. 


### Как вообще работает
Создана джанго-комманда 
``` python manage.py run_client <n> ```  
где n - это количество дней от текущего момента, за который нужно загрузить ворклоги. 

Эта команда удаляте все существующие ворклоги, таски жиры, заказы финолога.
И загружает новые за указанный период.  
Смысл в том, что синхронизировать эту информацию сложно. Поэтому решено просто 
ежедневно загружать заново. 

По основному ендпоинту  
```https://jira-wl.wbtech.pro/jira-client-api/grouped-worklogs/```  
можно получить сгруппированные ворклоги. Туда нужно отправить параметры фильтрации.  
Важно!!! Нужно указывать jira account_id, иначе инфа придет сразу по всем пользователям, 
что малоинформативно. 
GET параметры: 

```updated``` - выборка по точному значению updated ворклога  
```started``` - выборка по точному значению started ворклога  
```created``` - выборка по точному значению created ворклога  
```account_id``` - выборка по точному значению account_id ворклога  
```issue__project```  - выборка по точному значению issue__project ворклога  

``updated_start_date``, ```updated_finish_date``` - выборка от до по указанному параметру  
```created_start_date```, ```created_finish_date``` - выборка от до по указанному параметру  
```started_start_date``` , ```started_finish_date``` - выборка от до по указанному параметру  

Можно комбинировать несколько параметров.
Например, чтобы получить ворклоги человека за определенный период, нужно отправить три параметра: 
```started_start_date```, ```started_finish_date```, ```account_id```


### Дополнительные сервисы
В жире и финологе есть одинаковые сущности с разными айдишниками. Например, в жире есть
проект AREND, и в финологе у него есть цифровой id. 
В проекте есть модели, которые хранят такие соответствия: 
`client.models.finolog.FinologProject`

Кроме того, есть некоторые jira таски (вида AREND-123), которые в финологе считаются заказами.  
`Заказ - это отдельная логика учета, типа отдельной фичи, за которую с заказчиком отдельно 
расплачиваются`  
Такие соответствия хранятся в `client.models.finolog.FinologOrder`

Заказы (инстансы `client.models.finolog.FinologOrder`) появляются в БД на этапе выполнения 
`run_client`. Логика:  
В финологе есть api метод для поиска заказов по jira ключам тасков (AREND-123). Т.е. после того,
как скачали с жиры ворклоги и уникальные таски, бежим по именам тасков и спрашиваем финолог - 
есть ли такой заказ. Если есть, сохраняем. 

#### Для разработчиков
Обратите внимание, что некоторые параметры в `grouped-worklogs/` подставляются в сериализаторе
в `.to_representation()`

### Адреса

jira-client-admin/ - админка
jira-client-api/worklogs/ - все ворклоги
jira-client-api/issues/ - все таски
jira-client-api/grouped-worklogs/ - сгруппированные ворклоги


superuser:
admin
asDqAf1SSf4


Сервер  
https://jira-wl.wbtech.pro/

Админка  
https://jira-wl.wbtech.pro/jira-client-admin  
admin  
asDqAf1SSf4

Все таски из жиры  
https://jira-wl.wbtech.pro/jira-client-api/issues/

Все ворклоги. Здесь удобно посмотреть параметры фильтрации для группированных ворклогов  
https://jira-wl.wbtech.pro/jira-client-api/worklogs/

Основной ендпоинт  
https://jira-wl.wbtech.pro/jira-client-api/grouped-worklogs/

Здесь можно посмотреть список всех проектов. Сюда же через POST можно отправить 
данные для создания нового  
https://jira-wl.wbtech.pro/jira-client-api/finolog-projects/

### Возможные доделки
* включить простую токен авторизацию